---
trigger:
  paths:
    include:
      - backend/**
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageName: 'my-backend-app'

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.0.x'
  displayName: 'Install .NET SDK'

- script: |
    cd backend
    dotnet restore
    dotnet build --no-restore -c Release
    dotnet publish --no-restore -c Release -o out
  displayName: 'Build & Publish .NET App'

- script: |
    echo "Published output:"
    ls -la backend/out
  displayName: 'Verify Publish Output'

- task: Docker@2
  inputs:
    containerRegistry: '<your-service-connection-name>'  # e.g. DockerHub, ACR
    repository: '$(imageName)'
    command: 'buildAndPush'
    Dockerfile: 'backend/Dockerfile'
    tags: |
      $(Build.BuildId)
  displayName: 'Build and Push Docker Image'
